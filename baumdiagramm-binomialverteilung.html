<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Baumdiagramme der Binomialverteilung" />
    <meta name="author" content="Dr. Sven FÃ¼hring" />
    <meta name="robots" content="index,follow" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <title>Baumdiagramme der Binomialverteilung</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .diagramm-row {
        display: flex;
        gap: 10px;
        justify-content: center;
        align-items: flex-start;
        flex-wrap: wrap;
      }

      .eingabe-box {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 340px;
        margin: 0 auto 20px auto;
        background: #ffffff;
        border-radius: 10px;
        padding: 18px 20px;
        box-shadow: 0 2px 8px #0001;
      }

      .eingabe-zeile {
        display: flex;
        align-items: center;
        gap: 12px;
        justify-content: space-between;
      }

      .eingabe-zeile label {
        min-width: 110px;
      }

      .eingabe-zeile input[type="range"] {
        flex: 1;
        margin-left: 10px;
      }

      .eingabe-zeile:last-child {
        justify-content: center;
      }

      input[type="range"]:hover {
        cursor: ew-resize;
      }
    </style>
  </head>
  <body>
    <header>
      <a href="index.html" class="link-homepage" title="home">
        <h1>MatheChecks</h1>
      </a>
      <h2>Baumdiagramme der Binomialverteilung</h2>
    </header>

    <div class="eingabe-box">
      <div class="eingabe-zeile">
        <label for="nSlider">n = <span id="nWert">3</span></label>
        <input type="range" id="nSlider" min="1" max="10" value="3" />
      </div>
      <div class="eingabe-zeile">
        <label for="pSlider">p = <span id="pWert">0.5</span></label>
        <input
          type="range"
          id="pSlider"
          min="0"
          max="1"
          value="0.5"
          step="0.01"
        />
      </div>
      <div class="eingabe-zeile">
        <label for="kSlider">k = <span id="kWert">0</span></label>
        <input type="range" id="kSlider" min="0" max="10" value="0" />
      </div>
    </div>
    <div id="baum" style="max-width: 800px" class="diagramm"></div>

    <script>
      function generateBernoulliTree(n, p) {
        const nodes = {};
        const edges = [];
        const leaves = Array.from({ length: Math.pow(2, n) }, (_, i) => {
          return i
            .toString(2)
            .padStart(n, "0")
            .replace(/0/g, "T")
            .replace(/1/g, "N");
        });

        const spacing = 1.5;
        leaves.forEach((leaf, i) => {
          nodes[leaf] = {
            x: n,
            y: ((leaves.length - 1) / 2) * spacing - i * spacing,
          };
        });

        function placeParents(path) {
          if (path.length === 0) return;
          const parent = path.slice(0, -1);
          if (!nodes[parent]) {
            const left = parent + "T";
            const right = parent + "N";
            if (nodes[left] && nodes[right]) {
              nodes[parent] = {
                x: path.length - 1,
                y: (nodes[left].y + nodes[right].y) / 2,
              };
            }
          }
          edges.push({
            from: parent,
            to: path,
            prob: path.endsWith("T") ? p : 1 - p,
          });
          placeParents(parent);
        }

        for (const leaf of leaves) {
          placeParents(leaf);
        }

        nodes[""] = { x: 0, y: (nodes["T"].y + nodes["N"].y) / 2 };

        return { nodes, edges };
      }

      function plotBernoulliTree(n = 3, p = 0.5, k = null) {
        const { nodes, edges } = generateBernoulliTree(n, p);

        const highlightedEdges = new Set();
        for (const key in nodes) {
          if (key.length === n) {
            const numSuccesses = (key.match(/N/g) || []).length;
            if (k !== null && numSuccesses === k) {
              for (let i = 1; i <= key.length; i++) {
                const from = key.slice(0, i - 1);
                const to = key.slice(0, i);
                highlightedEdges.add(`${from}->${to}`);
              }
            }
          }
        }

        const nodeX = [];
        const nodeY = [];
        const nodeColors = [];

        for (const key in nodes) {
          nodeX.push(nodes[key].x);
          nodeY.push(nodes[key].y);
          if (key === "") {
            nodeColors.push("black");
          } else if (key.endsWith("T")) {
            nodeColors.push("green");
          } else if (key.endsWith("N")) {
            nodeColors.push("red");
          } else {
            nodeColors.push("gray");
          }
        }

        const nodeTrace = {
          x: nodeX,
          y: nodeY,
          mode: "markers",
          type: "scatter",
          marker: { size: 12, color: nodeColors },
          hoverinfo: "none",
        };

        const edgeTraces = [];

        for (const edge of edges) {
          const x0 = nodes[edge.from].x;
          const y0 = nodes[edge.from].y;
          const x1 = nodes[edge.to].x;
          const y1 = nodes[edge.to].y;

          const edgeKey = `${edge.from}->${edge.to}`;
          const isHighlighted = highlightedEdges.has(edgeKey);

          edgeTraces.push({
            x: [x0, x1],
            y: [y0, y1],
            mode: "lines",
            type: "scatter",
            line: {
              color: isHighlighted ? "gold" : "gray",
              width: isHighlighted ? 4 : 1,
            },
            hoverinfo: "none",
            showlegend: false,
          });

          edgeTraces.push({
            x: [(x0 + x1) / 2],
            y: [(y0 + y1) / 2],
            mode: "text",
            type: "scatter",
            text: [edge.prob.toFixed(2)],
            textposition: "middle center",
            hoverinfo: "none",
            showlegend: false,
            textfont: {
              size: 12,
              color: "black",
              family: "Arial",
            },
          });
        }

        const yValues = Object.values(nodes).map((n) => n.y);
        const yMin = Math.min(...yValues);
        const yMax = Math.max(...yValues);

        const layout = {
          xaxis: { visible: false },
          yaxis: {
            visible: false,
            range: [yMin - 1, yMax + 1],
          },
          plot_bgcolor: "white",
          margin: { l: 20, r: 20, t: 40, b: 20 },
          height: 50 * Math.pow(2, n),
          showlegend: false,
        };

        Plotly.newPlot("baum", [...edgeTraces, nodeTrace], layout);
      }

      document.addEventListener("DOMContentLoaded", () => {
        const nSlider = document.getElementById("nSlider");
        const pSlider = document.getElementById("pSlider");
        const kSlider = document.getElementById("kSlider");

        const nWert = document.getElementById("nWert");
        const pWert = document.getElementById("pWert");
        const kWert = document.getElementById("kWert");

        function updatePlot() {
          const n = parseInt(nSlider.value, 10);
          const p = parseFloat(pSlider.value);
          let k = parseInt(kSlider.value, 10);

          nWert.textContent = n;
          pWert.textContent = p;

          kSlider.max = n;
          if (k > n) {
            k = n;
            kSlider.value = n;
          }
          kWert.textContent = k;

          plotBernoulliTree(n, p, k);
        }

        nSlider.addEventListener("input", updatePlot);
        pSlider.addEventListener("input", updatePlot);
        kSlider.addEventListener("input", updatePlot);

        updatePlot();
      });
    </script>
  </body>
</html>
