<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Binomialverteilung – Einzel & Kumuliert</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>Binomialverteilung mit Intervallwahrscheinlichkeit</h2>

  <div>
    <label>n = <span id="nWert">10</span></label><br>
    <input type="range" id="nSlider" min="1" max="50" value="10"><br><br>

    <label>p = <span id="pWert">0.5</span></label><br>
    <input type="range" id="pSlider" min="0" max="1" value="0.5" step="0.01"><br><br>

    <label><input type="checkbox" id="autoY" checked> y-Achse automatisch skalieren</label><br><br>

    <label>Intervallgrenzen:</label>
    a = <input type="number" id="aGrenze" value="3" style="width:50px">
    b = <input type="number" id="bGrenze" value="7" style="width:50px"><br><br>

    <div><strong>Intervallwahrscheinlichkeit:</strong> <span id="intervallWert">P(3 ≤ X ≤ 7) = ...</span></div><br>
  </div>

  <div id="plotEinzeln" style="width:700px; height:400px;"></div>
  <div id="plotKumuliert" style="width:700px; height:400px;"></div>

  <script>
    function fakultaet(k) {
      if (k === 0 || k === 1) return 1;
      let f = 1;
      for (let i = 2; i <= k; i++) f *= i;
      return f;
    }

    function binomial(n, k, p) {
      const komb = fakultaet(n) / (fakultaet(k) * fakultaet(n - k));
      return komb * Math.pow(p, k) * Math.pow(1 - p, n - k);
    }

    function zeichne() {
      const n = parseInt(document.getElementById("nSlider").value);
      const p = parseFloat(document.getElementById("pSlider").value);
      const a = parseInt(document.getElementById("aGrenze").value);
      const b = parseInt(document.getElementById("bGrenze").value);
      const autoY = document.getElementById("autoY").checked;

      document.getElementById("nWert").innerText = n;
      document.getElementById("pWert").innerText = p.toFixed(2);

      const xWerte = [];
      const yEinzeln = [];
      const yKumuliert = [];
      const farbenEinzeln = [];

      let summe = 0;
      for (let k = 0; k <= n; k++) {
        const wkt = binomial(n, k, p);
        summe += wkt;

        xWerte.push(k);
        yEinzeln.push(wkt);
        yKumuliert.push(summe);

        if (k >= a && k <= b) {
          farbenEinzeln.push("rgba(255, 99, 132, 0.7)");
        } else {
          farbenEinzeln.push("rgba(54, 162, 235, 0.4)");
        }
      }

      // Intervallwahrscheinlichkeit berechnen
      const P_b = yKumuliert[b] ?? 0;
      const P_vor_a = a > 0 ? yKumuliert[a - 1] : 0;
      const P_intervall = P_b - P_vor_a;

      document.getElementById("intervallWert").innerText =
        `P(${a} ≤ X ≤ ${b}) = ${P_intervall.toFixed(4)}`;

      // Plot: Einzelwahrscheinlichkeiten
      const spurEinzeln = {
        x: xWerte,
        y: yEinzeln,
        type: "bar",
        marker: {
          color: farbenEinzeln,
          line: {
            color: "rgba(0, 0, 0, 0.5)",
            width: 1
          }
        },
        name: "P(X = k)"
      };

      const layoutEinzeln = {
        title: "Einzelwahrscheinlichkeiten P(X = k)",
        xaxis: { title: "k", tickmode: "linear" },
        yaxis: { title: "P(X = k)", range: autoY ? undefined : [0, 1] },
        bargap: 0,
        dragmode: "pan"
      };

      // Plot: Kumulierte Wahrscheinlichkeit
      const spurKumuliert = {
        x: xWerte,
        y: yKumuliert,
        type: "bar",
        marker: {
          color: xWerte.map(k => {
            if (k === b) return "rgba(200, 0, 0, 0.7)";       // P(X ≤ b)
            if (k === a - 1) return "rgba(255, 160, 160, 0.6)"; // P(X < a)
            return "rgba(100, 100, 100, 0.2)";
          }),
          line: {
            color: "rgba(50, 50, 50, 0.5)",
            width: 1
          }
        },
        name: "P(X ≤ k)"
      };

      const layoutKumuliert = {
        title: "Kumulierte Wahrscheinlichkeiten P(X ≤ k)",
        xaxis: { title: "k", tickmode: "linear" },
        yaxis: { title: "P(X ≤ k)", range: [0, 1.05] },
        bargap: 0,
        dragmode: "pan"
      };

      const config = { scrollZoom: true };

      Plotly.newPlot("plotEinzeln", [spurEinzeln], layoutEinzeln, config);
      Plotly.newPlot("plotKumuliert", [spurKumuliert], layoutKumuliert, config);
    }

    // Eventlistener
    document.getElementById("nSlider").addEventListener("input", zeichne);
    document.getElementById("pSlider").addEventListener("input", zeichne);
    document.getElementById("aGrenze").addEventListener("input", zeichne);
    document.getElementById("bGrenze").addEventListener("input", zeichne);
    document.getElementById("autoY").addEventListener("change", zeichne);

    // Start
    zeichne();
  </script>
</body>
</html>
