<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Marked Vorschau</title>
</head>
<body>

<h1>Vorschau</h1>

<div id="toc"></div>
<hr>
<div id="content"></div>

<!-- Marked laden -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  // Prüfen, ob marked geladen wurde
  if (typeof marked === 'undefined') {
    document.body.innerHTML += '<p style="color:red">Marked wurde nicht geladen!</p>';
  }

  // Markdown-Text
  const markdownText = `
# Einführung

Ein bisschen Text.

## Verlinkung innerhalb des Dokuments

Noch mehr Text.

## Schluss

Letzter Abschnitt.
`;

  // Custom Renderer mit Slug-ID
  const renderer = new marked.Renderer();
  const slugger = new marked.Slugger();

  renderer.heading = function (text, level) {
    const slug = slugger.slug(text);
    return '<h' + level + ' id="' + slug + '">' + text + '</h' + level + '>';
  };

  marked.setOptions({ renderer });

  // Markdown parsen
  const container = document.getElementById('content');
  container.innerHTML = marked.parse(markdownText);

  // Inhaltsverzeichnis generieren
  const tocContainer = document.getElementById('toc');
  const headings = container.querySelectorAll('h2, h3');
  const tocList = document.createElement('ul');

  headings.forEach(heading => {
    const li = document.createElement('li');
    if (heading.tagName === 'H3') {
      li.style.marginLeft = '20px';
    }

    const a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;

    li.appendChild(a);
    tocList.appendChild(li);
  });

  tocContainer.appendChild(tocList);
</script>

</body>
</html>
